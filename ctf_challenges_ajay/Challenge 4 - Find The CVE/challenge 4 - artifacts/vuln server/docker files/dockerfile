FROM debian:bookworm

ENV DEBIAN_FRONTEND=noninteractive

RUN apt-get update && apt-get install -y \
    openssh-server \
    vsftpd \
    bind9 \
    apache2 \
    postfix \
    dovecot-core dovecot-pop3d \
    inetutils-ping net-tools nano \
    supervisor && \
    apt-get clean && rm -rf /var/lib/apt/lists/*

# Create default user
RUN useradd -m -s /bin/bash ctf && echo 'ctf:ctf123' | chpasswd

# Setup SSH#
#RUN mkdir /var/run/sshd

# Create supervisor config directory
RUN mkdir -p /var/log/supervisor /etc/supervisor/conf.d

# Copy config files
COPY configs/vsftpd.conf /etc/vsftpd.conf
COPY configs/named.conf.options /etc/bind/named.conf.options
COPY configs/dovecot.conf /etc/dovecot/dovecot.conf

# Supervisor configuration
COPY supervisord.conf /etc/supervisor/conf.d/supervisord.conf

EXPOSE 21 22 25 533 80 110

CMD ["/usr/bin/supervisord", "-n"]
